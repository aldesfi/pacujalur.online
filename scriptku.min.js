let jalurData=[];function parseCSV(e){const t=e.trim().split("\n"),a=t[0].split(",");jalurData=t.slice(1).map((e=>{const t=e.split(",");let n={};return a.forEach(((e,a)=>n[e.trim()]=t[a]?.trim()||"")),n}))}function renderTable(){const e=document.querySelector("#jalurTable tbody");e.innerHTML="",jalurData.forEach((t=>{let a=document.createElement("tr");a.innerHTML=`\n          <td id="noKiri-${t.No}" class="${"L"==t.Pemenang?"ditandai_admin":"L"==localStorage.getItem(`${t.No}`)?"ditandai":""}">${t.No} \n          ${t.Pemenang?"":`<input type="checkbox" \n                        id="checkbox-${t.No}#L" \n                        value="${t.No}#L" \n                        style="display: none;" \n                        onchange="toggleCheckbox(this)" \n                        ${"L"===localStorage.getItem(t.No)?"checked":""}>`}\n          </td>\n          <td id="namaKiri-${t.No}" class="${"L"==t.Pemenang?"ditandai_admin":"L"==localStorage.getItem(`${t.No}`)?"ditandai":""}">${t.NamaKiri}</td>\n          <td id="asalKiri-${t.No}" class="${"L"==t.Pemenang?"ditandai_admin":"L"==localStorage.getItem(`${t.No}`)?"ditandai":""}">${t.AsalKiri}</td>\n          \n          <td id="noKanan-${t.No}" class="${"R"==t.Pemenang?"ditandai_admin":"R"==localStorage.getItem(`${t.No}`)?"ditandai":""}">${t.No} \n          ${t.Pemenang?"":`<input type="checkbox" \n                          id="checkbox-${t.No}#R" \n                          value="${t.No}#R" \n                          style="display: none;" \n                          onchange="toggleCheckbox(this)" \n                          ${"R"===localStorage.getItem(t.No)?"checked":""}>`}\n            </td>\n          \n          <td id="namaKanan-${t.No}" class="${"R"==t.Pemenang?"ditandai_admin":"R"==localStorage.getItem(`${t.No}`)?"ditandai":""}">${t.NamaKanan}</td>\n          <td id="asalKanan-${t.No}" class="${"R"==t.Pemenang?"ditandai_admin":"R"==localStorage.getItem(`${t.No}`)?"ditandai":""}">${t.AsalKanan}</td>\n        `,e.appendChild(a)}))}function filterTable(){const e=document.getElementById("searchNama").value.toLowerCase(),t=document.getElementById("filterAsal").value.toLowerCase(),a=document.querySelector("#jalurTable tbody").getElementsByTagName("tr");for(let n=0;n<a.length;n++){let o=a[n].getElementsByTagName("td"),i=o[1].textContent.toLowerCase(),l=o[2].textContent.toLowerCase(),c=o[4].textContent.toLowerCase(),d=o[5].textContent.toLowerCase(),s=i.includes(e)||c.includes(e),m=""===t||l.includes(t)||d.includes(t);a[n].style.display=s&&m?"":"none"}}function generatePDF(){const e=document.getElementById("jalurTable"),t={filename:`pacujalur-${(new Date).toISOString().replace(/[:.]/g,"-")}.pdf`,margin:[5,5,5,5],image:{type:"jpeg",quality:.98},html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4",orientation:"portrait"}};html2pdf().set(t).from(e).toPdf().get("pdf").save()}function resetCheck(){const e=document.querySelectorAll('input[type="checkbox"]'),t=document.querySelectorAll('[id^="namaKiri-"], [id^="namaKanan-"]'),a=document.querySelectorAll('[id^="asalKiri-"], [id^="asalKanan-"]'),n=document.querySelectorAll('[id^="noKiri-"], [id^="noKanan-"]');localStorage.clear(),e.forEach((e=>{e.checked=!1,e.classList.remove("ditandai")})),t.forEach((e=>{e.classList.remove("ditandai")})),a.forEach((e=>{e.classList.remove("ditandai")})),n.forEach((e=>{e.classList.remove("ditandai")}))}function munculkanCheck(){const e=document.getElementById("aktif_lidi");e.classList.toggle("active"),e.textContent=e.classList.contains("active")?"Simpan Lidi":"Pakai Lidi";document.getElementById("reset_lidi").style.display=e.classList.contains("active")?"inline":"none";document.querySelectorAll('input[type="checkbox"]').forEach((e=>{e.style.display="none"===e.style.display?"inline":"none"}))}function toggleCheckbox(e){const t=e.value;console.log("Checkbox toggled:",t);const[a,n]=t.split("#");if(console.log("No:",a,"Side:",n),"L"==n){const e=document.getElementById(`checkbox-${a}#R`);e.checked&&(e.checked=!e.checked);const t=document.getElementById(`namaKiri-${a}`),n=document.getElementById(`asalKiri-${a}`),o=document.getElementById(`noKiri-${a}`),i=document.getElementById(`namaKanan-${a}`),l=document.getElementById(`asalKanan-${a}`),c=document.getElementById(`noKanan-${a}`);t&&(t.classList.toggle("ditandai"),i.classList.remove("ditandai")),n&&(n.classList.toggle("ditandai"),l.classList.remove("ditandai")),o&&(o.classList.toggle("ditandai"),c.classList.remove("ditandai"))}else{const e=document.getElementById(`checkbox-${a}#L`);e.checked&&(e.checked=!e.checked);const t=document.getElementById(`namaKanan-${a}`),n=document.getElementById(`asalKanan-${a}`),o=document.getElementById(`noKanan-${a}`),i=document.getElementById(`namaKiri-${a}`),l=document.getElementById(`asalKiri-${a}`),c=document.getElementById(`noKiri-${a}`);t&&(t.classList.toggle("ditandai"),i.classList.remove("ditandai")),n&&(n.classList.toggle("ditandai"),l.classList.remove("ditandai")),o&&(o.classList.toggle("ditandai"),c.classList.remove("ditandai"))}localStorage.setItem(a,n)}function hitungAsal(){const e=document.getElementById("jalurTable"),t={};let a=0;e.querySelectorAll("tbody tr").forEach((e=>{const n=e.cells;if(n.length>=6){const e=n[2].textContent.trim().split("/").pop().trim(),o=n[5].textContent.trim().split("/").pop().trim();e&&(t[e]=(t[e]||0)+1,a++),o&&(t[o]=(t[o]||0)+1,a++)}})),document.querySelectorAll("#asalList .asal").forEach((e=>{const a=e.getAttribute("data-code");e.textContent=t[a]||0})),document.getElementById("totalAsal").textContent=a}fetch("jalur_hari_2-1.csv").then((e=>e.text())).then((e=>{parseCSV(e),renderTable(),hitungAsal()})).catch((e=>console.error("Gagal membaca CSV:",e)));